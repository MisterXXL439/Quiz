<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gewinde-Quiz</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 30px; background: #f0f4f8; }
  h1 { color: #333; margin-bottom: 10px; font-size: 2.2em; }
  #question { font-size: 2.5em; margin: 25px; color: #1a73e8; }
  #answer { font-size: 1.8em; padding: 12px; width: 120px; text-align: center; border-radius: 10px; border: 2px solid #ccc; }
  #feedback { margin: 20px; font-size: 1.5em; height: 2em; transition: all 0.3s; }
  #score { margin: 20px; font-size: 1.2em; white-space: pre-line; }
  #timerBarContainer { width: 80%; max-width: 400px; height: 25px; background: #ddd; margin: 10px auto; border-radius: 15px; overflow: hidden; }
  #timerBar { width: 100%; height: 100%; background: #1a73e8; transition: width 0.05s linear; }
  #progressBarContainer { width: 80%; max-width: 400px; height: 25px; background: #ccc; margin: 10px auto; border-radius: 15px; overflow: hidden; }
  #progressBar { width: 0%; height: 100%; background: #34a853; transition: width 0.3s; }
  #finalBarContainer { width: 80%; max-width: 400px; height: 25px; background: #ddd; margin: 20px auto; border-radius: 15px; overflow: hidden; display:none; position: relative; }
  #finalCorrect { height: 100%; background: #34a853; float:left; }
  #finalWrong { height: 100%; background: #ea4335; float:left; }
  #finalPercent { position: absolute; width: 100%; text-align: center; top: 0; left: 0; line-height: 25px; font-weight: bold; color: white; text-shadow: 1px 1px 2px black; }
  select, button { font-size: 1.2em; padding: 12px 20px; margin: 10px; border-radius: 10px; border: none; cursor: pointer; }
  select { background: #f0f0f0; color: #333; }
  button { background: #1a73e8; color: white; }
  button:active { background: #1665c1; }
  input:focus { outline: none; border-color: #1a73e8; }
  @media (max-width: 500px) {
    #question { font-size: 2em; }
    #answer { width: 100px; font-size: 1.5em; }
  }
</style>
</head>
<body>

<h1>Gewinde-Quiz</h1>

<div>
  Zeitlimit:
  <select id="timeSelect">
    <option value="3000">3 Sekunden</option>
    <option value="5000" selected>5 Sekunden</option>
    <option value="7000">7 Sekunden</option>
    <option value="0">Unendlich</option>
  </select>
  Wiederholungen pro Gewinde:
  <select id="repeatSelect">
    <!-- Optionen von 1 bis 10 -->
    <script>
      for(let i=1;i<=10;i++){
        document.write(`<option value="${i}"${i===3?' selected':''}>${i}</option>`);
      }
    </script>
  </select>
  <button id="startBtn">Start</button>
</div>

<div id="question">Dr√ºcke Start, um zu beginnen</div>
<input type="number" id="answer" placeholder="Antwort" step="0.01" disabled>
<div id="timerBarContainer"><div id="timerBar"></div></div>
<div id="progressBarContainer"><div id="progressBar"></div></div>
<div id="feedback"></div>
<div id="score"></div>

<div id="finalBarContainer">
  <div id="finalCorrect"></div>
  <div id="finalWrong"></div>
  <div id="finalPercent"></div>
</div>

<script>
const gewinde = {
  "M3": 0.5,
  "M4": 0.7,
  "M5": 0.8,
  "M6": 1.0,
  "M8": 1.25,
  "M10": 1.5,
  "M12": 1.75,
  "M16": 2.0
};

let richtigZaehler = {};
let falschZaehler = {};
let currentGewinde = "";
let lastGewinde = null;
let lastWert = null;
let timer;
let timerInterval;
let quizActive = false;
let timeLimit = 5000;
let totalCorrect = 0;
let totalAnswers = 0;
let repeatTarget = 3;

function resetCounters() {
  richtigZaehler = {};
  falschZaehler = {};
  for (let g in gewinde) {
    richtigZaehler[g] = 0;
    falschZaehler[g] = 0;
  }
}

function pickRandomGewinde() {
  let remaining = Object.keys(gewinde).filter(g => richtigZaehler[g] < repeatTarget);
  if (remaining.length === 0) return null;

  if (remaining.length > 1) {
    remaining = remaining.filter(g => g !== lastGewinde && gewinde[g] !== lastWert);
    if (remaining.length === 0) remaining = Object.keys(gewinde).filter(g => richtigZaehler[g] < repeatTarget);
  }

  const index = Math.floor(Math.random() * remaining.length);
  lastGewinde = remaining[index];
  lastWert = gewinde[lastGewinde];
  return lastGewinde;
}

function startQuiz() {
  quizActive = true;
  document.getElementById("startBtn").disabled = true;
  document.getElementById("answer").disabled = false;
  document.getElementById("answer").focus();
  timeLimit = parseInt(document.getElementById("timeSelect").value);
  repeatTarget = parseInt(document.getElementById("repeatSelect").value);
  totalCorrect = 0;
  totalAnswers = 0;
  resetCounters();
  document.getElementById("progressBar").style.width = "0%";
  document.getElementById("finalBarContainer").style.display = "none";
  nextQuestion();
}

function nextQuestion() {
  clearTimeout(timer);
  stopTimerBar();
  resetTimerBar();

  currentGewinde = pickRandomGewinde();
  if (!currentGewinde) {
    document.getElementById("question").innerText = "üéâ Quiz beendet! üéâ";
    document.getElementById("feedback").innerText = "";
    document.getElementById("score").innerText = "";
    document.getElementById("answer").disabled = true;

    const correctPercent = totalAnswers ? (totalCorrect / totalAnswers) * 100 : 0;
    document.getElementById("finalBarContainer").style.display = "block";
    document.getElementById("finalCorrect").style.width = correctPercent + "%";
    document.getElementById("finalWrong").style.width = (100 - correctPercent) + "%";
    document.getElementById("finalPercent").innerText = Math.round(correctPercent) + "% richtig";

    document.getElementById("startBtn").disabled = false;
    quizActive = false;
    return;
  }

  document.getElementById("question").innerText = currentGewinde;
  document.getElementById("answer").value = "";
  document.getElementById("answer").focus();
  document.getElementById("feedback").innerText = "";

  if (timeLimit > 0) {
    startTimerBar(timeLimit);
    timer = setTimeout(() => {
      if (quizActive) checkAnswer(true);
    }, timeLimit);
  }
}

function checkAnswer(timeout = false) {
  if (timeLimit > 0) clearTimeout(timer);
  stopTimerBar();
  totalAnswers++;
  const input = parseFloat(document.getElementById("answer").value);

  if (!timeout && input === gewinde[currentGewinde]) {
    richtigZaehler[currentGewinde]++;
    totalCorrect++;
    document.getElementById("feedback").innerText = "‚úÖ Richtig!";
    document.getElementById("feedback").style.color = "green";
    updateProgress();
  } else {
    falschZaehler[currentGewinde]++;
    document.getElementById("feedback").innerText = `‚ùå Falsch! Richtige Antwort: ${gewinde[currentGewinde]}`;
    document.getElementById("feedback").style.color = "red";
  }

  updateScore();
  setTimeout(nextQuestion, 1000);
}

function updateScore() {
  let text = `Richtige Antworten pro Gewinde (Ziel: ${repeatTarget}):\n`;
  for (let g in richtigZaehler) {
    text += `${g}: ${richtigZaehler[g]} / ${repeatTarget}\n`;
  }
  document.getElementById("score").innerText = text;
}

function updateProgress() {
  const totalTarget = repeatTarget * Object.keys(gewinde).length;
  const progress = Math.min(100, (totalCorrect / totalTarget) * 100);
  document.getElementById("progressBar").style.width = progress + "%";
}

function startTimerBar(duration) {
  const bar = document.getElementById("timerBar");
  let start = Date.now();
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    let elapsed = Date.now() - start;
    let percent = Math.max(0, 100 - (elapsed / duration * 100));
    bar.style.width = percent + "%";
    if (percent <= 0) clearInterval(timerInterval);
  }, 50);
}

function resetTimerBar() {
  document.getElementById("timerBar").style.width = "100%";
}

function stopTimerBar() {
  clearInterval(timerInterval);
  document.getElementById("timerBar").style.width = "0%";
}

document.getElementById("startBtn").addEventListener("touchstart", startQuiz);
document.getElementById("startBtn").addEventListener("click", startQuiz);
document.getElementById("answer").addEventListener("keydown", (e) => {
  if (e.key === "Enter") checkAnswer();
});
</script>

</body>
</html>
